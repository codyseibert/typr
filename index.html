<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<script src="bower_components/highlightjs/highlight.pack.js"></script>
<link rel="stylesheet" href="bower_components/highlightjs/styles/default.css">
<link rel="stylesheet" href="css/fontello.css">

<style>
    body{

    }

    .red{
        background-color: red;
    }
</style>

<html>
    <body>
<pre>
<code class="javascript" id="code">function() {
    console.log("omg");
}
</code>
</pre>
    </body>

    <script>
        //hljs.initHighlightingOnLoad();

        $(document).ready(function() {
            var code = $("#code");
            var text = code.text();
            code.html("");

            for (var i = 0; i < text.length; i += 1) {
                var char = text.charAt(i);
                if (char === '\n') {
                    code.append("<span class='char icon-level-up'>\n<span>");
                } else {
                    code.append("<span class='char'>" + char + "<span>");
                }
            }

            var $cursor = $(".char").first();
            $cursor.addClass("red");

            var step = function () {
                $cursor.removeClass("red");
                $cursor = $cursor.next();
                $cursor.addClass("red");
            }

            $(document).keypress(function(event) {
                var code = event.keyCode || event.which;
                var char = String.fromCharCode(code)
                var cursorChar = $cursor.text();

                if ((code === 13 && cursorChar === '\n') || char === cursorChar) {
                    step()
                }

                if ($cursor.text() === ' ' && $cursor.next().text() === ' ') {
                    console.log("true");
                    while ($cursor.text() === ' ' && $cursor.next().text() === ' ') {
                        step()
                    }
                    step()
                }
            });
        });
    </script>
</html>
